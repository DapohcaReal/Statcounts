<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Statcounts - YouTube Sub Count & Compare</title>
  <link rel="icon" href="Statcounts_logo.ico" type="image/ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-default.min.css" />
  <style>
    /* Your existing CSS styles here (omitted for brevity, keep as is) */
  </style>
</head>
<body>
  <div class="top-buttons">
    <button class="toggle-btn" onclick="toggleTheme()">Toggle Mode</button>
    <button class="toggle-btn" onclick="toggleMode()">Single/Compare</button>
  </div>

  <h1 id="main-title">Statcounts â€“ Compare YouTube Subscribers</h1>

  <div class="inputs">
    <input id="channel1" type="text" placeholder="Enter Channel ID 1" />
    <input id="channel2" type="text" placeholder="Enter Channel ID 2" />
    <button onclick="fetchSubs()">Fetch</button>
  </div>

  <div class="compare-container">
    <div class="user-box" id="user1">
      <img id="user1-pfp" src="https://via.placeholder.com/120?text=No+Image" alt="User 1 Profile" />
      <div class="username" id="user1-name">User 1</div>
      <div class="subs odometer" id="user1-subs">0</div>
      <div class="label-subs">Subscribers</div>
    </div>
    <div class="user-box" id="user2">
      <img id="user2-pfp" src="https://via.placeholder.com/120?text=No+Image" alt="User 2 Profile" />
      <div class="username" id="user2-name">User 2</div>
      <div class="subs odometer" id="user2-subs">0</div>
      <div class="label-subs">Subscribers</div>
    </div>
  </div>

  <div class="sub-diff odometer" id="sub-diff">0</div>

  <div class="stats-container">
    <div class="stats-box" id="stats1">
      <h3>User 1 Stats</h3>
      <div class="stat-item"><span class="stat-label">Views:</span> <span class="stat-value odometer" id="user1-views">0</span></div>
      <div class="stat-item"><span class="stat-label">Videos:</span> <span class="stat-value odometer" id="user1-videos">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Day:</span> <span class="stat-value odometer" id="user1-subs-day">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Hour:</span> <span class="stat-value odometer" id="user1-subs-hour">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Min:</span> <span class="stat-value odometer" id="user1-subs-min">0</span></div>
    </div>
    <div class="stats-box" id="stats2">
      <h3>User 2 Stats</h3>
      <div class="stat-item"><span class="stat-label">Views:</span> <span class="stat-value odometer" id="user2-views">0</span></div>
      <div class="stat-item"><span class="stat-label">Videos:</span> <span class="stat-value odometer" id="user2-videos">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Day:</span> <span class="stat-value odometer" id="user2-subs-day">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Hour:</span> <span class="stat-value odometer" id="user2-subs-hour">0</span></div>
      <div class="stat-item"><span class="stat-label">Subs / Min:</span> <span class="stat-value odometer" id="user2-subs-min">0</span></div>
    </div>
  </div>

  <div class="error" id="error-msg"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/odometer.min.js"></script>

  <script>
    const apiBase = 'https://mixerno.space/api/youtube-channel-counter/user/';
    let compareMode = true;

    function getQueryParams() {
      const params = {};
      const query = window.location.search.substring(1);
      if (!query) return params;
      const pairs = query.split('&');
      for (const pair of pairs) {
        const [key, value] = pair.split('=');
        if (key && value) {
          params[key] = decodeURIComponent(value);
        }
      }
      return params;
    }

    function updateURLParams(id1, id2) {
      const url = new URL(window.location);
      if (id1 && id2) {
        url.searchParams.set('id1', id1);
        url.searchParams.set('id2', id2);
        url.searchParams.delete('id');
      } else if (id1) {
        url.searchParams.set('id', id1);
        url.searchParams.delete('id1');
        url.searchParams.delete('id2');
      } else {
        url.searchParams.delete('id');
        url.searchParams.delete('id1');
        url.searchParams.delete('id2');
      }
      window.history.replaceState({}, '', url.toString());
    }

    async function fetchChannelData(id) {
      const res = await fetch(apiBase + encodeURIComponent(id));
      if (!res.ok) throw new Error('Invalid response for: ' + id);
      const data = await res.json();

      const subs = data.counts.find(c => c.value === 'subscribers');
      const views = data.counts.find(c => c.value === 'views');
      const videos = data.counts.find(c => c.value === 'videos');
      const name = data.user.find(u => u.value === 'name');
      const pfp = data.user.find(u => u.value === 'pfp');

      let subsPerDay = 0, subsPerHour = 0, subsPerMin = 0;
      if (data.statistics && data.statistics.length >= 2) {
        const stats = data.statistics;
        const last = stats[stats.length - 1];
        const prev = stats[stats.length - 2];
        const subDiff = last.subscribers - prev.subscribers;
        const timeDiffSec = (new Date(last.time) - new Date(prev.time)) / 1000;
        if (timeDiffSec > 0) {
          subsPerDay = (subDiff / timeDiffSec) * 86400;
          subsPerHour = (subDiff / timeDiffSec) * 3600;
          subsPerMin = (subDiff / timeDiffSec) * 60;
        }
      }

      return {
        name: name?.count || 'Unknown',
        pfp: pfp?.count || 'https://via.placeholder.com/120?text=No+Image',
        subscribers: subs?.count || 0,
        views: views?.count || 0,
        videos: videos?.count || 0,
        subsPerDay: Math.max(0, Math.round(subsPerDay)),
        subsPerHour: Math.max(0, Math.round(subsPerHour)),
        subsPerMin: Math.max(0, Math.round(subsPerMin)),
      };
    }

    async function fetchSubs() {
      document.getElementById('error-msg').textContent = '';
      const id1 = document.getElementById('channel1').value.trim();
      const id2 = document.getElementById('channel2').value.trim();

      if (!id1 || (compareMode && !id2)) {
        document.getElementById('error-msg').textContent = 'Please enter channel ID(s).';
        return;
      }

      updateURLParams(id1, compareMode ? id2 : null);

      try {
        const data1 = await fetchChannelData(id1);
        updateUserDisplay('user1', data1);

        if (compareMode) {
          const data2 = await fetchChannelData(id2);
          updateUserDisplay('user2', data2);
          const diff = Math.abs(data1.subscribers - data2.subscribers);
          document.getElementById('sub-diff').innerHTML = diff.toLocaleString();
        } else {
          document.getElementById('sub-diff').innerHTML = '';
        }
      } catch (err) {
        document.getElementById('error-msg').textContent = err.message;
      }
    }

    function updateUserDisplay(userId, data) {
      document.getElementById(`${userId}-name`).textContent = data.name;
      document.getElementById(`${userId}-pfp`).src = data.pfp;
      odometerUpdate(`${userId}-subs`, data.subscribers);
      odometerUpdate(`${userId}-views`, data.views);
      odometerUpdate(`${userId}-videos`, data.videos);
      odometerUpdate(`${userId}-subs-day`, data.subsPerDay);
      odometerUpdate(`${userId}-subs-hour`, data.subsPerHour);
      odometerUpdate(`${userId}-subs-min`, data.subsPerMin);
    }

    function odometerUpdate(id, value) {
      const el = document.getElementById(id);
      if (el.innerHTML != value.toString()) {
        el.innerHTML = value;
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function toggleMode() {
      compareMode = !compareMode;

      document.getElementById('channel2').style.display = compareMode ? 'inline-block' : 'none';
      document.getElementById('user2').style.display = compareMode ? 'block' : 'none';
      document.getElementById('stats2').style.display = compareMode ? 'block' : 'none';
      document.getElementById('sub-diff').style.display = compareMode ? 'block' : 'none';

      document.getElementById('main-title').textContent = compareMode
        ? 'Statcounts - Compare YouTube Subscribers'
        : 'Statcounts - YouTube Sub Count';

      if (!compareMode) {
        document.getElementById('channel2').value = '';
        odometerUpdate('user2-subs', 0);
        odometerUpdate('user2-views', 0);
        odometerUpdate('user2-videos', 0);
        odometerUpdate('user2-subs-day', 0);
        odometerUpdate('user2-subs-hour', 0);
        odometerUpdate('user2-subs-min', 0);
      }
    }

    setInterval(() => {
      const id1 = document.getElementById('channel1').value.trim();
      const id2 = document.getElementById('channel2').value.trim();
      if (id1 && (!compareMode || id2)) fetchSubs();
    }, 2000);

    window.onload = () => {
      const params = getQueryParams();

      if (params.id1 && params.id2) {
        if (!compareMode) toggleMode();
        document.getElementById('channel1').value = params.id1;
        document.getElementById('channel2').value = params.id2;
        fetchSubs();
      } else if (params.id) {
        if (compareMode) toggleMode();
        document.getElementById('channel1').value = params.id;
        fetchSubs();
      } else {
        if (compareMode) toggleMode();
      }
    };
  </script>
</body>
</html>
